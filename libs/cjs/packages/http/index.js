"use strict";const $=require("axios"),x=require("qs"),I=({baseURL:S,headers:R,beforeRequestHandler:m,response401:y,responseErrorCallback:a,responseCallback:h,errorMessageCallback:n})=>{const u=$.create({baseURL:S,withCredentials:!1,timeout:12e4,headers:R}),j=e=>(e.mock&&(e.baseURL="/",e.url=`/mock${e.url}`),e.header&&(e.headers={...e.headers,...e.header||{}}),typeof m=="function"&&(e=m(e)),e),E=({data:e,status:s,headers:i,config:o})=>{var w;const{code:t,data:d,message:H,msg:f,errorCode:p,errorMessage:l}=e,{legacy:P,useHeaders:_}=o,c=window.__NUWA_CODE_MESSAGE;if(h&&h(e),s===200&&(+t==200||p==="NO-ERROR"))return _?{data:d,headers:i}:d;if(P&&e.suc)return d;if(p&&p!=="NO-ERROR")return n&&n(l),Promise.reject(e);if(t&&((w=t==null?void 0:t.toString())==null?void 0:w.length)===10){let r;const q=t.toString().slice(2,3);return c&&(c!=null&&c[t])?r=c[t]:f?r=q==="S"?`${f}；错误码：${t}`:f:q==="S"?r=`系统繁忙，请稍后重试；错误码：${t}`:r="网络请求错误，请稍后重试",n&&n(r),Promise.reject(e)}else return t?t===200?d:(t!==4001&&n&&n(f??H??l),Promise.reject(e)):e},O=e=>{var i,o;let s="网络请求错误，请重试";if(e!=null&&e.response){switch(e.response.status){case 401:s=e.response.data.message,typeof y=="function"&&y();break;case 404:s="接口不存在";break}const t=(i=e==null?void 0:e.response)==null?void 0:i.data;t!=null&&t.msg&&(s=t.msg),(o=t==null?void 0:t.errors)!=null&&o.length&&(s=t==null?void 0:t.errors.join(","))}return n&&n(s),typeof a=="function"&&a(e),Promise.reject(e)};return u.interceptors.request.use(j),u.interceptors.response.use(E,O),{get:async(e,s,i)=>await u.get(e,{params:s,...i??{},paramsSerializer:{serialize:o=>x.stringify(o,{arrayFormat:"repeat"})}}),post:async(e,s,i)=>await u.post(e,s,i),del:async(e,s)=>await u.delete(e,s),request:async e=>await u.request(e)}};module.exports=I;
